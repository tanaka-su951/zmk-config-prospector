name: Build ZMK Firmware (Official Action Final)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    # ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©
    env:
      BOARD: seeeduino_xiao_ble
      SHIELD: prospector_scanner
      ZMK_STABLE_TAG: 3.5.0 # ğŸš¨ ã‚¿ã‚°åã‚’ 3.5.0 ã«è¨­å®š (ä¿®æ­£æ¸ˆã¿) ğŸš¨

    steps:
    - name: Checkout ZMK Config (Your Repo)
      uses: actions/checkout@v4
      with:
        # ZMKã‚³ã‚¢ã‚’ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦å–å¾—ã™ã‚‹ãŸã‚ã«å¿…é ˆ
        submodules: recursive 
        fetch-depth: 0

    - name: Set up Zephyr/ZMK Build Environment
      # ğŸš¨ ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã€Gitã‚¯ãƒ­ãƒ¼ãƒ³ã€west init/updateã€SDKã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’å…¨ã¦è‡ªå‹•ã§å‡¦ç†ã—ã¾ã™ ğŸš¨
      uses: zmkfirmware/zmk-build-action@v2
      with:
        # ZMKã‚³ã‚¢ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š
        ref: ${{ env.ZMK_STABLE_TAG }} 

    - name: Run West Build
      run: |
        echo "--- west buildå®Ÿè¡Œ ---"
        # å…¬å¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ç’°å¢ƒä¸‹ã§ã¯ã€ã‚³ãƒãƒ³ãƒ‰ã¯éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«
        west build -b ${{ env.BOARD }} -- -DSHIELD=${{ env.SHIELD }}

    - name: Archive artifacts
      uses: actions/upload-artifact@v4
      with:
        name: firmware-${{ env.BOARD }}-${{ env.SHIELD }}
        path: build/zephyr/zmk.uf2
        retention-days: 7
