    - name: Checkout Stable Tag (Final Fix)
      run: |
        echo "--- 2. 安定版タグ ${{ env.ZMK_STABLE_TAG }} に強制チェックアウト ---"
        cd zmk
        
        # 🚨 修正 1: リモートからの全タグの強制取得を確保
        git fetch --tags
        
        # 🚨 修正 2: タグ名のバリエーションを試す
        TAG_NAME="${{ env.ZMK_STABLE_TAG }}"
        V_TAG_NAME="v${{ env.ZMK_STABLE_TAG }}"
        
        # 3.5.0 が存在するか、v3.5.0 が存在するかを確認し、対応するタグ名を使用
        if git rev-parse --verify "refs/tags/${TAG_NAME}" >/dev/null 2>&1; then
            echo "Found tag: ${TAG_NAME}"
            git checkout "${TAG_NAME}"
        elif git rev-parse --verify "refs/tags/${V_TAG_NAME}" >/dev/null 2>&1; then
            echo "Found tag: ${V_TAG_NAME}"
            git checkout "${V_TAG_NAME}"
        else
            echo "Error: Neither tag '${TAG_NAME}' nor '${V_TAG_NAME}' found. Falling back to 'main'."
            git checkout main
        fi
        
        cd ..
