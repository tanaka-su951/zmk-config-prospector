name: Build ZMK Firmware (OfficialAction Final)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    # ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©
    env:
      BOARD: seeeduino_xiao_ble
      SHIELD: prospector_scanner
      ZMK_STABLE_TAG: 3.5.0 

    steps:
    - name: Checkout ZMK Config (Your Repo)
      uses: actions/checkout@v4
      with:
        submodules: recursive 
        fetch-depth: 0

    - name: Set up Zephyr/ZMK Build Environment
      # ğŸš¨ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ @v3 ã«æŒ‡å®š ğŸš¨
      uses: zmkfirmware/zmk-build-action@v3
      with:
        # ZMKã‚³ã‚¢ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š
        ref: ${{ env.ZMK_STABLE_TAG }} 

    - name: Run West Build
      run: |
        echo "--- west buildå®Ÿè¡Œ ---"
        west build -b ${{ env.BOARD }} -- -DSHIELD=${{ env.SHIELD }}

    - name: Archive artifacts
      uses: actions/upload-artifact@v4
      with:
        name: firmware-${{ env.BOARD }}-${{ env.SHIELD }}
        path: build/zephyr/zmk.uf2
        retention-days: 7
